<?php

function getReviews(PDO $pdo, STRING $status = null, INT $limit = null, INT $page = null): array
{
  $sql = "SELECT * FROM reviews ORDER BY id DESC";

  if ($status) {
    $sql = "SELECT * FROM reviews WHERE status = :status ORDER BY id DESC";
  }

  if ($limit && !$page) {
    $sql .= ' LIMIT :limit';
  }

  if ($page) {
    $sql .= ' LIMIT :limit OFFSET :offset';
  }

  $stmt = $pdo->prepare($sql);

  if ($status) {
    $stmt->bindValue(':status', $status, PDO::PARAM_STR);
  }

  if ($limit) {
    $stmt->bindValue(':limit', $limit, PDO::PARAM_INT);
  }

  if ($page) {
    $offset = $limit * ($page - 1);
    $stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
  }

  $stmt->execute();
  return $stmt->fetchAll(PDO::FETCH_ASSOC);
}

function setReviewStatus(PDO $pdo, INT $id, STRING $status): bool
{
  $sql = "UPDATE reviews SET status = :status WHERE id = :id";
  $stmt = $pdo->prepare($sql);
  $stmt->bindValue(':status', $status, PDO::PARAM_STR);
  $stmt->bindValue(':id', $id, PDO::PARAM_INT);

  return $stmt->execute();
}

function getReviewHapinness(INT $note): STRING
{
  switch ($note) {
    
    case 1:
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <g clip-path="url(#clip0_386_88)">
        <path d="M6.74531 18.6844C6.15937 18.4734 5.85469 17.8266 6.06562 17.2453C6.88594 14.9719 9.32344 13.5 12 13.5C14.6766 13.5 17.1141 14.9719 17.9344 17.2453C18.1453 17.8266 17.8406 18.4734 17.2547 18.6844C16.6734 18.8953 16.0266 18.5906 15.8156 18.0047C15.3844 16.8047 13.9313 15.75 12 15.75C10.0687 15.75 8.61563 16.8047 8.18438 18.0047C7.97344 18.5906 7.32656 18.8953 6.74531 18.6844ZM9.76875 9.75C9.76875 10.5797 9.09375 11.25 8.26875 11.25C7.43906 11.25 6.76875 10.5797 6.76875 9.75C6.76875 8.92031 7.43906 8.25 8.26875 8.25C9.09375 8.25 9.76875 8.92031 9.76875 9.75ZM14.2687 9.75C14.2687 8.92031 14.9391 8.25 15.7687 8.25C16.5937 8.25 17.2687 8.92031 17.2687 9.75C17.2687 10.5797 16.5937 11.25 15.7687 11.25C14.9391 11.25 14.2687 10.5797 14.2687 9.75ZM24 12C24 18.6281 18.6281 24 12 24C5.37188 24 0 18.6281 0 12C0 5.37188 5.37188 0 12 0C18.6281 0 24 5.37188 24 12ZM12 2.25C6.61406 2.25 2.25 6.61406 2.25 12C2.25 17.3859 6.61406 21.75 12 21.75C17.3859 21.75 21.75 17.3859 21.75 12C21.75 6.61406 17.3859 2.25 12 2.25Z" fill="#D84545"/>
      </g>
      <defs>
        <clipPath id="clip0_386_88">
          <rect width="24" height="24" fill="white"/>
        </clipPath>
      </defs>
    </svg>';
    case 2:
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <g clip-path="url(#clip0_386_86)">
        <path d="M6.76875 9.75C6.76875 8.92031 7.43906 8.25 8.26875 8.25C9.09375 8.25 9.76875 8.92031 9.76875 9.75C9.76875 10.5797 9.09375 11.25 8.26875 11.25C7.43906 11.25 6.76875 10.5797 6.76875 9.75ZM17.2687 9.75C17.2687 10.5797 16.5937 11.25 15.7687 11.25C14.9391 11.25 14.2687 10.5797 14.2687 9.75C14.2687 8.92031 14.9391 8.25 15.7687 8.25C16.5937 8.25 17.2687 8.92031 17.2687 9.75ZM15.375 15.375C15.9984 15.375 16.5 15.8766 16.5 16.5C16.5 17.1234 15.9984 17.625 15.375 17.625H8.625C8.00156 17.625 7.5 17.1234 7.5 16.5C7.5 15.8766 8.00156 15.375 8.625 15.375H15.375ZM24 12C24 18.6281 18.6281 24 12 24C5.37188 24 0 18.6281 0 12C0 5.37188 5.37188 0 12 0C18.6281 0 24 5.37188 24 12ZM12 21.75C17.3859 21.75 21.75 17.3859 21.75 12C21.75 6.61406 17.3859 2.25 12 2.25C6.61406 2.25 2.25 6.61406 2.25 12C2.25 17.3859 6.61406 21.75 12 21.75Z" fill="#D89D45"/>
      </g>
      <defs>
        <clipPath id="clip0_386_86">
          <rect width="24" height="24" fill="white"/>
        </clipPath>
      </defs>
    </svg>';
    case 3:
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <g clip-path="url(#clip0_386_84)">
        <path d="M9.76875 9.75C9.76875 10.5797 9.09375 11.25 8.26875 11.25C7.43906 11.25 6.76875 10.5797 6.76875 9.75C6.76875 8.92031 7.43906 8.25 8.26875 8.25C9.09375 8.25 9.76875 8.92031 9.76875 9.75ZM14.2687 9.75C14.2687 8.92031 14.9391 8.25 15.7687 8.25C16.5937 8.25 17.2687 8.92031 17.2687 9.75C17.2687 10.5797 16.5937 11.25 15.7687 11.25C14.9391 11.25 14.2687 10.5797 14.2687 9.75ZM0 12C0 5.37188 5.37188 0 12 0C18.6281 0 24 5.37188 24 12C24 18.6281 18.6281 24 12 24C5.37188 24 0 18.6281 0 12ZM12 2.25C6.61406 2.25 2.25 6.61406 2.25 12C2.25 17.3859 6.61406 21.75 12 21.75C17.3859 21.75 21.75 17.3859 21.75 12C21.75 6.61406 17.3859 2.25 12 2.25Z" fill="#D8C945"/>
      </g>
      <defs>
        <clipPath id="clip0_386_84">
          <rect width="24" height="24" fill="white"/>
        </clipPath>
      </defs>
    </svg>';
    case 4:
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <g clip-path="url(#clip0_386_80)">
        <path d="M12 16.5C13.7438 16.5 14.9625 15.6797 15.675 14.9109C16.0922 14.4563 16.8047 14.4234 17.2641 14.8453C17.7187 15.2672 17.7469 15.9797 17.325 16.4344C16.2984 17.5547 14.5172 18.75 12 18.75C9.48281 18.75 7.70156 17.5547 6.675 16.4344C6.25312 15.9797 6.23906 15.2672 6.73594 14.8453C7.19531 14.4234 7.90781 14.4563 8.325 14.9109C9.0375 15.6797 10.2562 16.5 12 16.5ZM9.76875 9.75C9.76875 10.5797 9.09375 11.25 8.26875 11.25C7.43906 11.25 6.76875 10.5797 6.76875 9.75C6.76875 8.92031 7.43906 8.25 8.26875 8.25C9.09375 8.25 9.76875 8.92031 9.76875 9.75ZM14.2687 9.75C14.2687 8.92031 14.9391 8.25 15.7687 8.25C16.5937 8.25 17.2687 8.92031 17.2687 9.75C17.2687 10.5797 16.5937 11.25 15.7687 11.25C14.9391 11.25 14.2687 10.5797 14.2687 9.75ZM24 12C24 18.6281 18.6281 24 12 24C5.37188 24 0 18.6281 0 12C0 5.37188 5.37188 0 12 0C18.6281 0 24 5.37188 24 12ZM12 2.25C6.61406 2.25 2.25 6.61406 2.25 12C2.25 17.3859 6.61406 21.75 12 21.75C17.3859 21.75 21.75 17.3859 21.75 12C21.75 6.61406 17.3859 2.25 12 2.25Z" fill="#8CB755"/>
      </g>
      <defs>
        <clipPath id="clip0_386_80">
          <rect width="24" height="24" fill="white"/>
        </clipPath>
      </defs>
    </svg>';
    case 5:
      return '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <g clip-path="url(#clip0_386_82)">
        <path d="M12 16.5C13.7438 16.5 14.9625 15.6797 15.675 14.9109C16.0922 14.4563 16.8047 14.4234 17.2641 14.8453C17.7187 15.2672 17.7469 15.9797 17.325 16.4344C16.2984 17.5547 14.5172 18.75 12 18.75C9.48281 18.75 7.70156 17.5547 6.675 16.4344C6.25312 15.9797 6.23906 15.2672 6.73594 14.8453C7.19531 14.4234 7.90781 14.4563 8.325 14.9109C9.0375 15.6797 10.2562 16.5 12 16.5ZM10.2 10.725L10.1906 10.7109C10.1812 10.7016 10.1719 10.6875 10.1578 10.6688C10.125 10.6313 10.0828 10.5797 10.0266 10.5141C9.90937 10.3781 9.74531 10.2047 9.54844 9.98906C9.13594 9.66563 8.6625 9.375 8.25 9.375C7.8375 9.375 7.36406 9.66563 6.95156 9.98906C6.75469 10.2047 6.59063 10.3781 6.47344 10.5141C6.41719 10.5797 6.33281 10.6313 6.34219 10.6688C6.28594 10.6875 6.31875 10.7016 6.30938 10.7109L6.3 10.725C6.20156 10.8563 6.03281 10.9078 5.88281 10.8563C5.72813 10.8047 5.625 10.6594 5.625 10.5C5.625 9.66094 5.93906 8.83125 6.40313 8.2125C6.8625 7.60312 7.52344 7.125 8.25 7.125C8.97656 7.125 9.6375 7.60312 10.0969 8.2125C10.5609 8.83125 10.875 9.66094 10.875 10.5C10.875 10.6594 10.7719 10.8047 10.6172 10.8563C10.4672 10.9078 10.2984 10.8563 10.2 10.725ZM17.7 10.725L17.6906 10.7109C17.6812 10.7016 17.6719 10.6875 17.6578 10.6688C17.625 10.6313 17.5828 10.5797 17.5266 10.5141C17.4094 10.3781 17.2453 10.2047 17.0484 9.98906C16.6359 9.66563 16.1625 9.375 15.75 9.375C15.3375 9.375 14.8641 9.66563 14.4516 9.98906C14.2547 10.2047 14.0906 10.3781 13.9734 10.5141C13.9172 10.5797 13.8328 10.6313 13.8422 10.6688C13.7859 10.6875 13.8188 10.7016 13.8094 10.7109L13.8 10.725C13.7016 10.8563 13.5328 10.9078 13.3828 10.8563C13.2281 10.8047 13.125 10.6594 13.125 10.5C13.125 9.66094 13.4391 8.83125 13.9031 8.2125C14.3625 7.60312 15.0234 7.125 15.75 7.125C16.4766 7.125 17.1375 7.60312 17.5969 8.2125C18.0609 8.83125 18.375 9.66094 18.375 10.5C18.375 10.6594 18.2719 10.8047 18.1172 10.8563C17.9672 10.9078 17.7984 10.8563 17.7 10.725ZM24 12C24 18.6281 18.6281 24 12 24C5.37188 24 0 18.6281 0 12C0 5.37188 5.37188 0 12 0C18.6281 0 24 5.37188 24 12ZM12 2.25C6.61406 2.25 2.25 6.61406 2.25 12C2.25 17.3859 6.61406 21.75 12 21.75C17.3859 21.75 21.75 17.3859 21.75 12C21.75 6.61406 17.3859 2.25 12 2.25Z" fill="#55B76B"/>
      </g>
      <defs>
        <clipPath id="clip0_386_82">
          <rect width="24" height="24" fill="white"/>
        </clipPath>
      </defs>
    </svg>';
  }
}

function createReview(PDO $pdo, STRING $nickname, STRING $content, INT $note): bool {
  $sql = "INSERT INTO reviews (nickname, content, note, status) VALUES (:nickname, :content, :note, 'pending')";
  $stmt = $pdo->prepare($sql);
  $stmt->bindValue(':nickname', $nickname, PDO::PARAM_STR);
  $stmt->bindValue(':content', $content, PDO::PARAM_STR);
  $stmt->bindValue(':note', $note, PDO::PARAM_INT);

  return $stmt->execute();
}